{% extends "core/base.html" %}
{% load humanize %}
{% block content %}
  <h2>Dashboard</h2>

  <h3>Portfolio Snapshot</h3>
  <div class="metric-grid">
    <div class="metric-card">
      <div class="metric-label">Properties</div>
      <div class="metric-value">{{ properties_count }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Active Tenants</div>
      <div class="metric-value">{{ active_tenants_count }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Open Maintenance</div>
      <div class="metric-value">{{ open_maintenance_count }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Urgent Open</div>
      <div class="metric-value">{{ urgent_open_count }}</div>
    </div>
  </div>

  <h3>Rent Overview</h3>
  <div class="metric-grid">
    <div class="metric-card">
      <div class="metric-label">Paid (Count)</div>
      <div class="metric-value">{{ rent_paid_count }}</div>
      <div class="muted">${{ rent_paid_total|floatformat:2|intcomma }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Due (Count)</div>
      <div class="metric-value">{{ rent_due_count }}</div>
      <div class="muted">${{ rent_due_total|floatformat:2|intcomma }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Late (Count)</div>
      <div class="metric-value">{{ rent_late_count }}</div>
      <div class="muted">${{ rent_late_total|floatformat:2|intcomma }}</div>
    </div>
  </div>

  <h3>Rent This Month ({{ current_month }}/{{ current_year }})</h3>
  <div class="metric-grid">
    <div class="metric-card">
      <div class="metric-label">Paid</div>
      <div class="metric-value">${{ paid_this_month|floatformat:2|intcomma }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Due</div>
      <div class="metric-value">${{ due_this_month|floatformat:2|intcomma }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Late</div>
      <div class="metric-value">${{ late_this_month|floatformat:2|intcomma }}</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">In Progress Maint.</div>
      <div class="metric-value">{{ in_progress_maintenance_count }}</div>
    </div>
  </div>

  <h3>Per Property Summary</h3>
  {% if property_summaries %}
    <table class="table">
      <tr>
        <th>Property</th>
        <th>Active Tenants</th>
        <th>Rent Paid</th>
        <th>Rent Due</th>
        <th>Rent Late</th>
        <th>Open Maint.</th>
        <th>Urgent</th>
      </tr>
      {% for row in property_summaries %}
        <tr>
          <td><a href="{% url 'core:property_detail' row.property.id %}">{{ row.property.name }}</a></td>
          <td>{{ row.active_tenants }}</td>
          <td>${{ row.rent_paid_total|floatformat:2|intcomma }}</td>
          <td>${{ row.rent_due_total|floatformat:2|intcomma }}</td>
          <td>${{ row.rent_late_total|floatformat:2|intcomma }}</td>
          <td>{{ row.open_maintenance }}</td>
          <td>{{ row.urgent_open }}</td>
        </tr>
      {% endfor %}
    </table>
  {% else %}
    <p class="muted">No properties yet. Add one to start seeing dashboard insights.</p>
    <p><a class="btn btn-primary" href="{% url 'core:property_create' %}">Add Property</a></p>
  {% endif %}
{% endblock %}
